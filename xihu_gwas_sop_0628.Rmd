---
title: "xihu gwas 0628"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# a1 data import

## raw data overview

è¡¨å‹:æ—©äº§ã€è¶…å¤§è¶…å°å©´å„¿(lowbirthwtã€macrosomia)ã€‚logisticã€‚

durationï¼ˆå­•æœŸï¼‰ linearã€‚

+----+------------+----------+-----------+---------+----------------+----------------------------------------------+
| id | è¡¨å‹       | æ–¹æ³•     | åå˜é‡    | æ ·æœ¬é‡N | Job id         | gwas name                                    |
+====+============+==========+===========+=========+================+==============================================+
| 1  | perterm    | logistic | pca10+age | 4342    | FUMA_job186763 | res_pca10_age_4000.assoc_pvalue2.logistic.gz |
+----+------------+----------+-----------+---------+----------------+----------------------------------------------+
| 1  | lowbirthwt | logistic | pca10+age | 4342    | xxx            | xxx                                          |
+----+------------+----------+-----------+---------+----------------+----------------------------------------------+
| 1  | macrosomia | logistic | pca10+age | 4342    | xxx            | xxx                                          |
+----+------------+----------+-----------+---------+----------------+----------------------------------------------+

## cov(xxbmld) = pca + å¹´é¾„

æ ·æœ¬æ•°ä¸€è‡´ã€‚

# a2 plink command

## é˜ˆå€¼æ€§çŠ¶ï¼ˆ1,2ï¼‰-\> logisticé€»è¾‘å›å½’

ç—…ä¾‹å¯¹ç…§ç ”ç©¶ ï¼ˆCase-control studyï¼‰: æ˜¯æŒ‡ä»¥ç°åœ¨æ‚£æœ‰æŸç—…çš„ç—…äººä¸ºæ‚£ç—…ç»„ï¼ˆç§°ä¸º Caseï¼‰ï¼Œä»¥æœªæ‚£è¯¥ç—…ä½†å…¶å®ƒæ¡ä»¶ä¸ç—…ä¾‹ç»„ç›¸ä¼¼çš„äººä¸ºå¦å¯¹ç…§ç»„ï¼ˆç§°ä¸º Controlï¼‰ã€‚\
plink çš„è¯­å¢ƒå«"case and control"ï¼Œå³è¡¨å‹å€¼æ•°æ®æ˜¯ä¸¤ç±»æ•°æ®ï¼š1,2ï¼ˆæ˜¯ï¼Œå¦ï¼Ÿã€æ—©äº§ å·¨å¤§å„¿ï¼Ÿã€‘ï¼‰ï¼Œå…¶ä¸­ 0 å’Œ-9 éƒ½è¡¨ç¤ºç¼ºå¤±ã€‚

| data                                                   | æ¥æº              | æ˜¯å¦gwas |
|--------------------------------------------------------|-------------------|----------|
| rawÂ dataÂ famÂ file                                      | [***4945***]{.ul} |          |
| excelÂ PhenotypeÂ table                                  | 4946              |          |
| excelÂ PhenotypeÂ tableÂ éªŒè¯å­é›†                         | 1063              | 1?       |
| gwasè¡¨å‹rawÂ dataæ•°Â                                     | [*4342*]{.ul}     | 1        |
| éªŒè¯å­é›†Â rawÂ dataÂ æ•°                                   | 527               |          |
| å·¨å¤§ï¼ˆå°ï¼‰å„¿é›†Â excelÂ PhenotypeÂ table                   | 4898              | 0        |
| å·¨å¤§ï¼ˆå°ï¼‰å„¿é›†Â rawÂ dataÂ æ•°(è¡¨å‹ä¿¡æ¯old&hugeäº¤é›†)       | 1513              | 0        |
| å·¨å¤§ï¼ˆå°ï¼‰å„¿é›†Â rawÂ dataÂ æ•°ï¼ˆè¡¨å‹ä¿¡æ¯old&huge&famäº¤é›†ï¼‰ | 4342              | 1        |

```{bash}
#eg 4760 = 4946 -> drop_na(preterm)
/home/wangzhe/projects/gwas/SNP_data/selected_two_cohorts -> raw data
wc -l /home/wangzhe/projects/xihu2gwas_github/phe2plus00.txt -> bcx; ğŸ†š ï¼ˆrow 4760ï¼‰
wc -l /home/wangzhe/projects/gwas/SNP_data/gcta_pca/pca10_age_4000.txt -> cov ğŸ†š ï¼ˆrow 4342ï¼‰
wc -l /home/wangzhe/projects/xihu2gwas_github/phe2plus00.txt (4760)

[/home/wangzhe/projects/gwas/SNP_data/gcta_pca]wc -l pca10.eigenvec
4945 pca10.eigenvec

åˆ¶ä½œlowbirthwtã€macrosomiaï¼Œçœ‹çœ‹æ˜¯å¦ä¿®æ”¹cov
è¿™ä¸ªæ˜¯å¦ç”¨1ï¼Œ0è¡¨ç¤ºï¼Ÿ
ID	lowbirthwt	macrosomia
V1_0010202	0	0
V1_0010204	0	0
V1_0010205	0	0

æ­¤å¤„æ˜¯å¦ç”¨1ï¼Œ2è¡¨ç¤ºï¼Ÿ
0010202 0010202 2
0010204 0010204 2
0010205 0010205 2

æ•°æ®å¤„ç†ï¼Œmerge than æŠŠ0 -> 2

1513 phe
1513 cov
# hi.R


```

```{bash}
#eg
#plink --bfile /home/wangzhe/projects/gwas/SNP_data/selected_two_cohorts --pheno /home/wangzhe/projects/github_star/GWA_tutorial/phe2.txt --logistic --covar /home/wangzhe/projects/gwas/SNP_data/gcta_pca/pca10_age_4000.txt --out res_pca10_age_4000xxx --allow-no-sex

plink --bfile /home/wangzhe/projects/gwas/SNP_data/selected_two_cohorts --pheno /home/wangzhe/projects/xihu2gwas_github/phe2plus00.txt --logistic --covar /home/wangzhe/projects/gwas/SNP_data/gcta_pca/pca10_age_4000.txt --out re_logistic --allow-no-sex

# togo
## lowbirthwt
plink --bfile /home/wangzhe/projects/gwas/SNP_data/selected_two_cohorts --pheno /home/wangzhe/projects/xihu2_0628/data/phe_sma.txt --logistic --covar /home/wangzhe/projects/xihu2_0628/data/pca10_age_4342.txt --out re_logistic_pca10_age_4342_low --allow-no-sex
## macrosomia
plink --bfile /home/wangzhe/projects/gwas/SNP_data/selected_two_cohorts --pheno /home/wangzhe/projects/xihu2_0628/data/phe_huge.txt --logistic --covar /home/wangzhe/projects/xihu2_0628/data/pca10_age_4342.txt --out re_logistic_pca10_age_4342_huge --allow-no-sex

```

## è¿ç»­æ€§çŠ¶ï¼ˆå®šé‡æ€§çŠ¶ï¼‰linear

# a3 output data

```{bash}
awk '!/'NA'/' re_logistic_pca10_age_4342_low.assoc.logistic >re_logistic_pca10_age_4342_low.assoc_NA.logistic
awk '!/'NA'/' re_logistic_pca10_age_4342_huge.assoc.logistic >re_logistic_pca10_age_4342_huge.assoc_NA.logistic
# 16G->9G -> ?
# p>10e-2? 

# å¤„ç†.gz----
library(data.table)
# if not .gz, can i use fread
data_huge <- fread("/home/wangzhe/projects/data_0628/re_logistic_pca10_age_4342_huge.assoc_NA.logistic") 
#system.time(t2 <- fread(____))

#data <- fread("/home/wangzhe/projects/gwas_cov_pca_age_logic/res_pca10_age_4000.assoc2.logistic.gz") #donot view big file  


data1 <- data_huge %>% 
  filter(P<10e-8) # 110145192
  
write_delim(data1, "/home/wangzhe/projects/xihu2_0628/output/re_logistic_pca10_age_4342_huge.assoc_e-8.logistic",col_names = T) # æ³¨æ„ä¿å­˜æ–‡ä»¶çš„åˆ†éš”ç¬¦æ˜¯ï¼Ÿ

data1 <- data_huge %>% 
  filter(P<10e-2) # 997588
write_delim(data1, "/home/wangzhe/projects/xihu2_0628/output/re_logistic_pca10_age_4342_huge.assoc_e-2.logistic",col_names = T) # æ³¨æ„ä¿å­˜æ–‡ä»¶çš„åˆ†éš”ç¬¦æ˜¯ï¼Ÿ


# other
data_low <- fread("/home/wangzhe/projects/data_0628/1_low/re_logistic_pca10_age_4342_low.assoc_NA.logistic") 
data1 <- data_low %>% 
  filter(P<10e-2) # 10558187
  
write_delim(data1, "/home/wangzhe/projects/xihu2_0628/output/re_logistic_pca10_age_4342_low.assoc_e-2.logistic",col_names = T) # æ³¨æ„ä¿å­˜æ–‡ä»¶çš„åˆ†éš”ç¬¦æ˜¯ï¼Ÿ

# å†å°ä¹Ÿè¦å‹ç¼© sop ğŸ˜Š
gzip /home/wangzhe/projects/xihu2_0628/output/re_logistic_pca10_age_4342_low.assoc_e-2.logistic
gzip /home/wangzhe/projects/xihu2_0628/output/re_logistic_pca10_age_4342_huge.assoc_e-2.logistic


```

# plot

# with python

# è‡ªåŠ¨åŒ–å¤„ç†

```{bash}
# å»é™¤NAè¡Œ
awk '!/'NA'/' re_linear_v1.assoc.linear >re_linear_v1.assoc2.linear
# å‹ç¼©
gzip re_linear_v1.assoc2.linear
# é¢„è§ˆå‹ç¼©
zcat re_linear_v1.assoc2.linear.gz | head
gzip -cd re_linear_v1.assoc2.linear.gz | head
# æå–å‹ç¼©æ–‡ä»¶p value <e8?
# æå–å‹ç¼©æ–‡ä»¶å‰10è¡Œï¼Ÿ

# å¤„ç†.gz----
library(data.table)
famid1 <- fread("/home/wangzhe/projects/gwas/SNP_data/gcta_pca/selected_two_cohorts.fam.gz")
# succeed
data <- fread("/home/wangzhe/projects/gwas_cov_pca_age_logic/res_pca10_age_4000.assoc2.logistic.gz") #donot view big file  
# succeed
data1 <- data %>% 
  filter(P<10e-8)
write_delim(data1, "/home/wangzhe/projects/gwas_cov_pca_age_logic/res_pca10_age_4000.assoc_pvalue8.logistic",col_names = T) # æ³¨æ„ä¿å­˜æ–‡ä»¶çš„åˆ†éš”ç¬¦
system("gzip /home/wangzhe/projects/gwas_cov_pca_age_logic/res_pca10_age_4000.assoc_pvalue8.logistic")


```

# write_xlsx vs write_delim

# github

```{bash}
# æ’¤é”€commit ä¸Šæ¬¡
git reset --soft HEAD^
# å½“gzå¤§äº100M,æ–‡æœ¬>50Må°±ä¸è¦å­˜äº†ã€‚å®¹æ˜“push fail
# çææå®šï¼šå½“å‰åˆ†æ”¯çš„æœ€æ–°æäº¤è½åäº
git push -u origin +master
#Everything up-to-date

```
